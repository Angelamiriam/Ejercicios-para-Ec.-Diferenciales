<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Modelos Diferenciales con Estilo</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link href="style.css" rel="stylesheet"/>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <h1>Modelos Diferenciales con Métodos Numéricos</h1>
    <nav class="navbar navbar-expand-lg mx-auto mt-3" style="max-width: 850px;">
      <div class="container-fluid justify-content-center gap-4">
        <a class="nav-link" href="#ej37"><i class="fas fa-dna"></i> Ejercicio 37</a>
        <a class="nav-link" href="#ej39"><i class="fas fa-virus"></i> Ejercicio 39</a>
        <a class="nav-link" href="#ej40"><i class="fas fa-tachometer-alt"></i> Ejercicio 40</a>
      </div>
    </nav>
  </header>

  <main class="container">
    <section id="ej37">
      <h2>Ejercicio 37 – Crecimiento poblacional</h2>
      <p>Modelo logístico con capacidad limitada.</p>
      <div class="text-center">
        <img src="img/problema37.jpg" alt="Problema 37">
      </div>
      <div class="alert alert-info" role="alert">
        <strong>Valores de Ejemplo:</strong> Población inicial = 100, Tiempo final = 20 años, Paso = 0.1 años.
      </div>
      <div class="row g-3 mb-3">
        <div class="col-md-3">
          <label class="form-label">Población inicial (indiv.)</label>
          <input type="number" id="y0_37" class="form-control" value="100">
        </div>
        <div class="col-md-3">
          <label class="form-label">Tiempo final (años)</label>
          <input type="number" id="tf_37" class="form-control" value="20">
        </div>
        <div class="col-md-3">
          <label class="form-label">Paso (años)</label>
          <input type="number" step="0.01" id="h_37" class="form-control" value="0.1">
        </div>
        <div class="col-md-3 align-self-end text-center">
          <button class="btn btn-primary me-2" onclick="runEj37Heun()">Heun</button>
          <button class="btn btn-danger" onclick="runEj37RK4()">RK4</button>
          <button class="btn btn-success" onclick="compararEj37()">Comparar</button>
        </div>
      </div>
      <canvas id="grafico37"></canvas>
      <div id="resultados37" class="table-responsive mt-3"></div>
      <h3 class="mt-4">Conclusión</h3>
      <div id="conclusion37" class="mt-3"></div>
    </section>
    <section id="ej39">
      <h2>Ejercicio 39 – Crecimiento de un tumor</h2>
      <p>Modelo con saturación.</p>
      <div class="text-center">
        <img src="img/problema39.jpg" alt="Problema 39">
      </div>
      <div class="alert alert-info" role="alert">
        <strong>Valores de Ejemplo:</strong> Tasa α = 0.8, Capacidad k = 60 mm², Exponente ν = 0.25, Área inicial A₀ = 1 mm², Tiempo = 30 días. (Paso h fijado a 0.1)
      </div>
      <div class="row g-3 mb-3">
        <div class="col-md-3">
          <label class="form-label">Tasa α</label>
          <input type="number" step="0.01" id="alpha_39" class="form-control" value="0.8">
        </div>
        <div class="col-md-3">
          <label class="form-label">Capacidad k (mm²)</label>
          <input type="number" id="k_39" class="form-control" value="60">
        </div>
        <div class="col-md-3">
          <label class="form-label">Exponente ν</label>
          <input type="number" step="0.01" id="nu_39" class="form-control" value="0.25">
        </div>
        <div class="col-md-3">
          <label class="form-label">Área inicial A₀ (mm²)</label>
          <input type="number" step="0.1" id="A0_39" class="form-control" value="1">
        </div>
        <div class="col-md-3">
          <label class="form-label">Tiempo (días)</label>
          <input type="number" id="tf_39" class="form-control" value="30">
        </div>
        <div class="col-md-3 align-self-end text-center">
          <button class="btn btn-primary me-2" onclick="runEj39Heun()">Heun</button>
          <button class="btn btn-danger" onclick="runEj39RK4()">RK4</button>
          <button class="btn btn-success" onclick="compararEj39()">Comparar</button>
        </div>
      </div>
      <canvas id="grafico39"></canvas>
      <div id="resultados39" class="table-responsive mt-3"></div>
      <h3 class="mt-4">Conclusión</h3>
      <div id="conclusion39" class="mt-3"></div>
    </section>

    <section id="ej40">
      <h2>Ejercicio 40 – Velocidad de caída</h2>
      <p>Caída libre con resistencia cuadrática.</p>
      <div class="text-center">
        <img src="img/problema40.jpg" alt="Problema 40">
      </div>
      <div class="alert alert-info" role="alert">
        <strong>Valores de Ejemplo:</strong> Velocidad inicial = 0 m/s, Tiempo final = 100 s, Paso = 0.25 s.
      </div>
      <div class="row g-3 mb-3">
        <div class="col-md-3">
          <label class="form-label">Velocidad inicial (m/s)</label>
          <input type="number" id="y0_40" class="form-control" value="0">
        </div>
        <div class="col-md-3">
          <label class="form-label">Tiempo final (s)</label>
          <input type="number" id="tf_40" class="form-control" value="100">
        </div>
        <div class="col-md-3">
          <label class="form-label">Paso (s)</label>
          <input type="number" step="0.01" id="h_40" class="form-control" value="0.25">
        </div>
        <div class="col-md-3 align-self-end text-center">
          <button class="btn btn-primary me-2" onclick="runEj40Heun()">Heun</button>
          <button class="btn btn-danger" onclick="runEj40RK4()">RK4</button>
          <button class="btn btn-success mt-2" onclick="compararEj40()">Comparar</button>
        </div>
      </div>
      <canvas id="grafico40"></canvas>
      <div id="resultados40" class="table-responsive mt-3"></div>
      <h3 class="mt-4">Conclusión</h3>
      <div id="conclusion40" class="mt-3"></div>
    </section>
    <div class="card mt-4 shadow-sm">
      <div class="card-header bg-light text-center">
        <strong>Comparación Teórica: Método de Heun vs RK4</strong>
      </div>
      <div class="card-body p-3">
        <div class="table-responsive">
          <table class="table table-bordered table-hover text-center align-middle">
            <thead class="table-secondary">
              <tr>
                <th>Criterio</th>
                <th>Método de Heun</th>
                <th>Método RK4</th>
              </tr>
            </thead>
            <tbody>
              <tr>
                <td>Orden de precisión</td>
                <td>2 (más preciso que Euler)</td>
                <td>4 (alta precisión)</td>
              </tr>
              <tr>
                <td>Evaluaciones de f(t, y) por paso</td>
                <td>2</td>
                <td>4</td>
              </tr>
              <tr>
                <td>Costo computacional</td>
                <td>Bajo a medio</td>
                <td>Alto (por más evaluaciones)</td>
              </tr>
              <tr>
                <td>Uso típico</td>
                <td>Problemas donde se requiere mejora sobre Euler sin mucho costo</td>
                <td>Cuando se busca alta precisión con pasos grandes</td>
              </tr>
              <tr>
                <td>Ventajas</td>
                <td>Sencillo, más preciso que Euler, rápido</td>
                <td>Muy preciso, estable y robusto</td>
              </tr>
              <tr>
                <td>Desventajas</td>
                <td>Menos preciso que RK4</td>
                <td>Mayor carga computacional</td>
              </tr>
            </tbody>
          </table>
        </div>
      </div>
    </div>

  </main>

  <footer>
    <p>&copy; 2025 - Métodos Numéricos Angela Miriam Chambi Loza</p>
  </footer>

  <script>
    function limpiarCanvas(id) {
      if (window[id + '_chart']) {
        window[id + '_chart'].destroy();
        delete window[id + '_chart'];
      }
    }

    function f37(t, y) {
      const L = 10000, k = 0.01;
      return k * y * (1 - y / L);
    }

    function runEj37Heun() {
      const y0 = parseFloat(document.getElementById('y0_37').value);
      const tf = parseFloat(document.getElementById('tf_37').value);
      const h = parseFloat(document.getElementById('h_37').value);
      resolver('grafico37', f37, y0, tf, h, 'resultados37', 'Heun', 'conclusion37');
    }

    function runEj37RK4() {
      const y0 = parseFloat(document.getElementById('y0_37').value);
      const tf = parseFloat(document.getElementById('tf_37').value);
      const h = parseFloat(document.getElementById('h_37').value);
      resolverRK4('grafico37', f37, y0, tf, h, 'resultados37', 'RK4', 'conclusion37');
    }

    // Función para modelo Ejercicio 39
    function f39(t, A) {
      const alpha = parseFloat(document.getElementById('alpha_39').value);
      const k = parseFloat(document.getElementById('k_39').value);
      const nu = parseFloat(document.getElementById('nu_39').value);
      return alpha * Math.pow(A, nu) * (1 - A / k);
    }

    function runEj39Heun() {
      const A0 = parseFloat(document.getElementById('A0_39').value);
      const tf = parseFloat(document.getElementById('tf_39').value);
      const h = 0.1;
      resolver('grafico39', f39, A0, tf, h, 'resultados39', 'Heun', 'conclusion39');
    }

    function runEj39RK4() {
      const A0 = parseFloat(document.getElementById('A0_39').value);
      const tf = parseFloat(document.getElementById('tf_39').value);
      const h = 0.1;
      resolverRK4('grafico39', f39, A0, tf, h, 'resultados39', 'RK4', 'conclusion39');
    }

    // Función para modelo Ejercicio 40
    function f40(t, v) {
      const g = 9.81;
      const k = 0.0025;
      return g - k * v * Math.abs(v);
    }

    function runEj40Heun() {
      const v0 = parseFloat(document.getElementById('y0_40').value);
      const tf = parseFloat(document.getElementById('tf_40').value);
      const h = parseFloat(document.getElementById('h_40').value);
      resolver('grafico40', f40, v0, tf, h, 'resultados40', 'Heun', 'conclusion40');
    }

    function runEj40RK4() {
      const v0 = parseFloat(document.getElementById('y0_40').value);
      const tf = parseFloat(document.getElementById('tf_40').value);
      const h = parseFloat(document.getElementById('h_40').value);
      resolverRK4('grafico40', f40, v0, tf, h, 'resultados40', 'RK4', 'conclusion40');
    }

    function resolver(canvasId, f, y0, tf, h, resultDivId, methodName, conclusionDivId) {
      limpiarCanvas(canvasId);
      const t0 = 0, n = Math.floor((tf - t0) / h);
      let t = t0, y = y0;
      const data = { labels: [], datasets: [{ label: methodName, data: [], borderColor: '#6b63b5', fill: false }] };
      const resultados = [];
      for (let i = 0; i <= n; i++) {
        data.labels.push(t.toFixed(2));
        data.datasets[0].data.push(y);
        resultados.push({ t: t.toFixed(2), y: y.toFixed(6) });
        let yEuler = y + h * f(t, y);
        y = y + (h / 2) * (f(t, y) + f(t + h, yEuler));
        t += h;
      }
      renderChart(canvasId, data);
      mostrarResultados(resultDivId, resultados);
      mostrarConclusion(conclusionDivId, methodName, resultados[resultados.length - 1].y);
    }

    function resolverRK4(canvasId, f, y0, tf, h, resultDivId, methodName, conclusionDivId) {
      limpiarCanvas(canvasId);
      const t0 = 0, n = Math.floor((tf - t0) / h);
      let t = t0, y = y0;
      const data = { labels: [], datasets: [{ label: methodName, data: [], borderColor: '#d9b8ff', fill: false }] };
      const resultados = [];
      for (let i = 0; i <= n; i++) {
        data.labels.push(t.toFixed(2));
        data.datasets[0].data.push(y);
        resultados.push({ t: t.toFixed(2), y: y.toFixed(6) });
        const k1 = h * f(t, y);
        const k2 = h * f(t + h / 2, y + k1 / 2);
        const k3 = h * f(t + h / 2, y + k2 / 2);
        const k4 = h * f(t + h, y + k3);
        y += (k1 + 2 * k2 + 2 * k3 + k4) / 6;
        t += h;
      }
      renderChart(canvasId, data);
      mostrarResultados(resultDivId, resultados);
      mostrarConclusion(conclusionDivId, methodName, resultados[resultados.length - 1].y);
    }

    function renderChart(id, chartData) {
      const ctx = document.getElementById(id).getContext('2d');
      window[id + '_chart'] = new Chart(ctx, {
        type: 'line',
        data: chartData,
        options: {
          responsive: true,
          plugins: {
            legend: { position: 'top' },
            title: { display: true, text: 'Solución numérica del modelo' }
          },
          animation: { duration: 1000, easing: 'easeOutQuart' },
          scales: {
            x: { title: { display: true, text: 'Tiempo (t)' } },
            y: { title: { display: true, text: 'y(t)' } }
          }
        }
      });
    }

    function mostrarResultados(divId, resultados) {
      const container = document.getElementById(divId);
      if (!container) return;
      let html = `<div style="max-height:300px; overflow-y:auto; border:1px solid #ddd; padding:0.5rem; border-radius:0.25rem;">`;
      html += `<table class="table table-sm table-striped table-bordered text-center mb-0"><thead><tr><th>t</th><th>y(t)</th></tr></thead><tbody>`;
      for (const r of resultados) {
        html += `<tr><td>${r.t}</td><td>${r.y}</td></tr>`;
      }
      html += `</tbody></table></div>`;
      container.innerHTML = html;
    }

    function compararEj37() {
      const y0 = parseFloat(document.getElementById('y0_37').value);
      const tf = parseFloat(document.getElementById('tf_37').value);
      const h = parseFloat(document.getElementById('h_37').value);
      compararMetodos('grafico37', f37, y0, tf, h, 'resultados37', 'conclusion37');
    }

    function compararEj39() {
      const A0 = parseFloat(document.getElementById('A0_39').value);
      const tf = parseFloat(document.getElementById('tf_39').value);
      const h = 0.1;
      compararMetodos('grafico39', f39, A0, tf, h, 'resultados39', 'conclusion39');
    }

    function compararEj40() {
      const v0 = parseFloat(document.getElementById('y0_40').value);
      const tf = parseFloat(document.getElementById('tf_40').value);
      const h = parseFloat(document.getElementById('h_40').value);
      compararMetodos('grafico40', f40, v0, tf, h, 'resultados40', 'conclusion40');
    }

    function compararMetodos(canvasId, f, y0, tf, h, resultDivId, conclusionDivId) {
      limpiarCanvas(canvasId);
      const t0 = 0, n = Math.floor((tf - t0) / h);
      let t = t0, yH = y0, yR = y0;

      const data = {
        labels: [],
        datasets: [
          {
            label: "Heun",
            data: [],
            borderColor: "#6b63b5",
            fill: false
          },
          {
            label: "RK4",
            data: [],
            borderColor: "#d9b8ff",
            fill: false
          }
        ]
      };

      const resultados = [];

      for (let i = 0; i <= n; i++) {
        data.labels.push(t.toFixed(2));
        data.datasets[0].data.push(yH);
        data.datasets[1].data.push(yR);
        resultados.push({ t: t.toFixed(2), heun: yH.toFixed(6), rk4: yR.toFixed(6) });

        // Heun
        const yEuler = yH + h * f(t, yH);
        yH = yH + (h / 2) * (f(t, yH) + f(t + h, yEuler));

        // RK4
        const k1 = h * f(t, yR);
        const k2 = h * f(t + h / 2, yR + k1 / 2);
        const k3 = h * f(t + h / 2, yR + k2 / 2);
        const k4 = h * f(t + h, yR + k3);
        yR += (k1 + 2 * k2 + 2 * k3 + k4) / 6;

        t += h;
      }

      renderChart(canvasId, data);
      mostrarResultadosComparados(resultDivId, resultados);
      mostrarConclusionComparativa(conclusionDivId, resultados[resultados.length - 1].heun, resultados[resultados.length - 1].rk4);
    }

    function mostrarResultadosComparados(divId, resultados) {
      const container = document.getElementById(divId);
      if (!container) return;
      let html = `<div style="max-height:300px; overflow-y:auto; border:1px solid #ddd; padding:0.5rem; border-radius:0.25rem;">`;
      html += `<table class="table table-sm table-striped table-bordered text-center mb-0"><thead><tr><th>t</th><th>Heun y(t)</th><th>RK4 y(t)</th></tr></thead><tbody>`;
      for (const r of resultados) {
        html += `<tr><td>${r.t}</td><td>${r.heun}</td><td>${r.rk4}</td></tr>`;
      }
      html += `</tbody></table></div>`;
      container.innerHTML = html;
    }

    function mostrarConclusion(divId, methodName, finalValue) {
      const conclusionDiv = document.getElementById(divId);
      if (!conclusionDiv) return;
      let conclusionText = "";
      if (divId === 'conclusion37') {
        conclusionText = `Para el Ejercicio 37 (Crecimiento poblacional) usando el método de **${methodName}**, la población final estimada es de aproximadamente **${parseFloat(finalValue).toFixed(2)}** individuos. Este modelo logístico muestra cómo la población crece hasta alcanzar una capacidad de carga limitada, suavizando su crecimiento a medida que se acerca a este límite.`;
      } else if (divId === 'conclusion39') {
        conclusionText = `En el Ejercicio 39 (Crecimiento de un tumor) con el método de **${methodName}**, el área final del tumor es de aproximadamente **${parseFloat(finalValue).toFixed(2)} mm²**. El modelo con saturación indica que el crecimiento del tumor se ralentiza a medida que se acerca a su tamaño máximo posible debido a factores limitantes.`;
      } else if (divId === 'conclusion40') {
        conclusionText = `Para el Ejercicio 40 (Velocidad de caída) utilizando el método de **${methodName}**, la velocidad final del objeto es de aproximadamente **${parseFloat(finalValue).toFixed(2)} m/s**. La resistencia cuadrática al aire provoca que la velocidad se estabilice en una velocidad terminal, impidiendo una aceleración indefinida.`;
      }
      conclusionDiv.innerHTML = `<div class="alert alert-success mt-3" role="alert">${conclusionText}</div>`;
    }

    function mostrarConclusionComparativa(divId, heunFinal, rk4Final) {
      const conclusionDiv = document.getElementById(divId);
      if (!conclusionDiv) return;
      let conclusionText = "";
      if (divId === 'conclusion37') {
        conclusionText = `Al comparar los métodos de Heun y RK4 para el Ejercicio 37 (Crecimiento poblacional), observamos que para los valores de ejemplo la población final estimada es de **${parseFloat(heunFinal).toFixed(2)}** (Heun) y **${parseFloat(rk4Final).toFixed(2)}** (RK4). Aunque ambos métodos capturan la tendencia logística, RK4, al ser de mayor orden, generalmente ofrece una mayor precisión en los resultados finales con el mismo tamaño de paso.`;
      } else if (divId === 'conclusion39') {
        conclusionText = `En el Ejercicio 39 (Crecimiento de un tumor), la comparación entre Heun y RK4 muestra un área final del tumor de **${parseFloat(heunFinal).toFixed(2)} mm²** (Heun) y **${parseFloat(rk4Final).toFixed(2)} mm²** (RK4). RK4 tiende a ser más cercano al valor verdadero (si se conociera) debido a su mayor precisión, lo que es crucial en modelos biológicos donde la exactitud es importante.`;
      } else if (divId === 'conclusion40') {
        conclusionText = `Para el Ejercicio 40 (Velocidad de caída), la comparación de Heun y RK4 arroja velocidades finales de **${parseFloat(heunFinal).toFixed(2)} m/s** (Heun) y **${parseFloat(rk4Final).toFixed(2)} m/s** (RK4). Ambos métodos modelan bien la velocidad terminal, pero RK4 proporcionará una convergencia más rápida y precisa hacia el valor real con menos pasos, lo que es ventajoso para simulaciones físicas.`;
      }
      conclusionDiv.innerHTML = `<div class="alert alert-success mt-3" role="alert">${conclusionText}</div>`;
    }

  </script>
</body>
</html>
